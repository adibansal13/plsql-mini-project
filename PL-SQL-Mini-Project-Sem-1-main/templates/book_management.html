{% extends "base.html" %}
{% block title %}Book Management{% endblock %}

{% block content %}
<div class="container mx-auto mt-5 p-4 md:p-8">
    <h2 class="text-3xl text-center mb-6 font-bold text-gray-800">
        {% if session.role == 'admin' %}
            üìö Book Management
        {% else %}
            üìö Available Books
        {% endif %}
    </h2>

    <!-- Top Actions: Search and Add Button -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-4 p-4 bg-white rounded-lg shadow-md">
        <!-- Search Form -->
        <form class="flex w-full md:w-auto mb-2 md:mb-0" method="GET" action="{{ url_for('search_books') }}">
            <input class="w-full px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" type="search" name="query" placeholder="Search by title or author..." value="{{ search_query or '' }}">
            <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r-lg" type="submit">Search</button>
        </form>

        <!-- Admin-only "Add Book" button -->
        {% if session.role == 'admin' %}
        <a href="{{ url_for('add_book') }}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg w-full md:w-auto transition duration-300">
            ‚ûï Add New Book
        </a>
        {% endif %}
    </div>

    <!-- Book Table -->
    <div class="overflow-x-auto shadow-md rounded-lg">
        <table class="min-w-full bg-white align-middle">
            <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Author</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Category</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Price (‚Çπ)</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">In Stock</th>
                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% if books %}
                    {% for book in books %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ book.title }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ book.author }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ book.category }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-semibold">‚Çπ{{ "%.2f"|format(book.price) }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm {{ 'text-red-600' if book.quantity == 0 else 'text-gray-600' }}">
                            {{ book.quantity }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        {% if session.role == 'admin' %}
                            <!-- Admin Actions -->
                            <a href="{{ url_for('update_book', book_id=book.book_id) }}" class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-2 px-3 rounded-lg mr-2 transition duration-300">‚úèÔ∏è Edit</a>
                            <form action="{{ url_for('delete_book', book_id=book.book_id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this book? This action cannot be undone.');">
                                <button type="submit" class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-2 px-3 rounded-lg transition duration-300">üóëÔ∏è Delete</button>
                            </form>
                        {% else %}
                            <!-- Customer Action -->
                            <form action="{{ url_for('add_to_cart', book_id=book.book_id) }}" method="POST" class="d-inline">
                                <input type="hidden" name="quantity" value="1">
                                {% if book.quantity > 0 %}
                                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-3 rounded-lg transition duration-300">üõí Add to Cart</button>
                                {% else %}
                                    <span class="bg-gray-300 text-gray-600 text-sm font-bold py-2 px-3 rounded-lg cursor-not-allowed">Out of Stock</span>
                                {% endif %}
                            </form>
                        {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-gray-500 py-10">
                            No books found matching your search.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
